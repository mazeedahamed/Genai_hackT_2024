import requests
import json
import pandas as pd

# List of JSON files to process
json_files = ["file1.json", "file2.json", "file3.json"]  # Add your JSON file names here

# API endpoint
url = "https://your-api-endpoint.com"

# Headers for the request
headers = {"Content-Type": "application/json"}

# List to store extracted data
data_list = []
names_list = []

# Process each JSON file
for json_file in json_files:
    try:
        # Load JSON body from file
        with open(json_file, "r") as file:
            data = json.load(file)

        # Send POST request
        response = requests.post(url, json=data, headers=headers)

        # Check if the request was successful
        if response.status_code == 200:
            response_data = response.json()

            # Extract required fields
            name = response_data.get("body", {}).get("account", {}).get("name", "N/A")
            age = response_data.get("body", {}).get("account", {}).get("age", "N/A")

            # Append data along with the file name
            data_list.append({"File": json_file, "Name": name, "Age": age})

            # Collect names for SQL query
            if name != "N/A":
                names_list.append(f"'{name}'")  # Add quotes for SQL formatting
        else:
            print(f"Error processing {json_file}: {response.status_code}, {response.text}")

    except Exception as e:
        print(f"Failed to process {json_file}: {str(e)}")

# Convert list to DataFrame and save to Excel
if data_list:
    df = pd.DataFrame(data_list)
    df.to_excel("output.xlsx", index=False)
    print("Data saved successfully to output.xlsx")

# Generate SQL query
if names_list:
    query = f"account_id IN ({', '.join(names_list)})"
    print("Generated SQL Query:")
    print(query)
else:
    print("No valid names found to generate SQL query.")
