import pandas as pd

# Load Excel files
ground_truth_file = "ground_truth.xlsx"
execution_results_file = "execution_results.xlsx"

gt_df = pd.read_excel(ground_truth_file)
exec_df = pd.read_excel(execution_results_file)

# Group Ground Truth by Account_ID, Party_Name, Type
gt_grouped = gt_df.groupby(["Account_ID", "Party_Name", "Type"]).agg({
    "Country": "first",
    "Status": lambda x: ", ".join(x.dropna().unique()),
    "Feedback": lambda x: ", ".join(x.dropna().unique())
}).reset_index()

# Merge Execution Results with Ground Truth on Party_Name
gt_exec_merged = pd.merge(gt_grouped, exec_df, 
                           left_on=["Account_ID", "Party_Name", "Type"],
                           right_on=["Account_ID", "Party_Name_AI", "Type"],
                           how="outer")

# Fill missing values
output_df = gt_exec_merged[["Account_ID", "Party_Name", "Type", "Country", "Status", "Feedback", "Party_Name_AI"]]
output_df = output_df.sort_values(by=["Account_ID", "Party_Name_AI"]).reset_index(drop=True)

# Save to output file
output_file = "output.xlsx"
output_df.to_excel(output_file, index=False)

print(f"Output saved to {output_file}")
